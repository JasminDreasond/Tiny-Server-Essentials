<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Tiny test! :3</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/TinyStreamManager.js"></script>
  </head>

  <body>
    <h1>Hello, tiny world!</h1>
    <h2><a href="./pudding.txt" target="_blank">Pudding! :3</a></h2>
    <p>This is a very simple HTML5 page.</p>

    <select id="micList"></select>

    <button id="active-stream">Active Stream</button>
    <button id="get-devices">Get Devices</button>

    <script>
      const socket = io('http://localhost:3050');
      const manager = new TinyStreamManager(socket);

      async function getDevices() {
        await manager.updateDeviceList();
        const micList = document.getElementById('micList');
        const mics = manager.getDevicesByKind('audio');
        mics.forEach((device) => {
          const opt = document.createElement('option');
          opt.value = device.deviceId;
          opt.textContent = device.label || `Microphone (${device.deviceId})`;
          micList.appendChild(opt);
        });

        console.log(manager.getDevicesByKind('audio'));
        console.log(manager.getDevicesByKind('video'));
        console.log(manager.getDevicesByKind('speaker'));
      }

      async function startAll() {
        await manager.updateDeviceList();

        // Lista todos os dispositivos
        console.table(manager.getDevicesByKind('audio'));
        console.table(manager.getDevicesByKind('video'));

        // Usa dispositivos especÃ­ficos se quiser
        const mic = await manager.startMicrophone(); // ou com deviceId
        const cam = await manager.startWebcam(); // ou com deviceId
        const screen = await manager.startScreenShare();

        manager.sendMicStreamOverSocket('mic');
        manager.sendWebcamStreamOverSocket('cam');
        manager.sendScreenStreamOverSocket('screen');
      }

      document.getElementById('active-stream').addEventListener('click', () => startAll());
      document.getElementById('get-devices').addEventListener('click', () => getDevices());
    </script>
  </body>
</html>
